<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planes - EcuTour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../shared/style.css">
</head>

<body>

    <div class="app-container p-4">

        <!-- ENCABEZADO ESTÃNDAR -->
        <header class="bg-blue-600 text-white p-6 rounded-2xl shadow-lg mb-6 sticky top-0 z-20">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold">Planes</h2>
                    <p class="text-blue-200 text-sm">Experiencias curadas</p>
                </div>
                <div class="text-center bg-white/20 p-2 rounded-lg">
                    <p class="text-xs">Puntos</p>
                    <p id="puntos-nav" class="text-xl font-bold text-yellow-300">...</p>
                </div>
            </div>
        </header>

        <!-- CONTAINER DE PLANES (DinÃ¡mico) -->
        <div class="space-y-5 pb-24" id="planesContainer">
            <!-- Inyectado por JS -->
        </div>

    </div>

    <!-- MODAL DE DETALLE DEL PLAN -->
    <div id="planModal"
        class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-3xl w-full max-w-md max-h-[90vh] overflow-y-auto shadow-2xl transform scale-95 transition-all duration-300"
            id="planModalContent">

            <!-- Imagen Hero -->
            <div class="relative h-48 w-full">
                <img id="modalHeroImg" src="" class="w-full h-full object-cover rounded-t-3xl">
                <button onclick="closePlanModal()"
                    class="absolute top-4 right-4 bg-black/50 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-black/70 transition">
                    &times;
                </button>
                <div class="absolute bottom-4 left-4">
                    <span id="modalTag"
                        class="bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-sm">
                        RECOMENDADO
                    </span>
                </div>
            </div>

            <div class="p-6">
                <!-- TÃ­tulo y Precio -->
                <div class="flex justify-between items-start mb-2">
                    <h2 id="modalTitle" class="text-2xl font-bold text-gray-900 leading-tight w-2/3">Nombre del Plan
                    </h2>
                    <div class="text-right">
                        <p id="modalPrice" class="text-xl font-bold text-green-600">$0</p>
                        <p id="modalPoints"
                            class="text-xs text-yellow-600 font-bold bg-yellow-50 px-2 py-0.5 rounded-full inline-block">
                            +0pts</p>
                    </div>
                </div>

                <p id="modalDesc" class="text-gray-500 text-sm mb-6 leading-relaxed">
                    DescripciÃ³n corta del plan.
                </p>

                <!-- Paquete Incluye -->
                <div class="bg-blue-50 rounded-xl p-4 mb-6">
                    <h3 class="font-bold text-blue-800 mb-3 text-sm flex items-center">
                        <i class="fas fa-gift mr-2"></i> Â¿QuÃ© incluye este paquete?
                    </h3>
                    <ul id="modalIncludes" class="space-y-2 text-sm text-gray-700">
                        <!-- Items -->
                    </ul>
                </div>

                <!-- Itinerario -->
                <div class="mb-8">
                    <h3 class="font-bold text-gray-900 mb-4 text-sm flex items-center">
                        <i class="far fa-clock mr-2"></i> Experiencia
                    </h3>
                    <div id="modalItinerary" class="space-y-4 relative border-l-2 border-gray-100 ml-2 pl-4">
                        <!-- Timeline Items -->
                    </div>
                </div>

                <!-- AcciÃ³n -->
                <button id="btnCompletar"
                    class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-blue-700 active:scale-95 transition flex items-center justify-center gap-2">
                    Completar y Ganar Puntos
                </button>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="../shared/session.js"></script>
    <script src="../shared/nav.js"></script>

    <script>
        // --- DATA DE PAQUETES ---
        const PlanesData = [
            {
                id: 'familiar',
                title: 'Plan Familiar: Fin de Semana en BaÃ±os',
                price: '$150',
                points: 200,
                tag: 'FAMILIAR',
                img: 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=80&w=1000&auto=format&fit=crop', // Nature/Travel
                description: 'Un escape perfecto para conectar con la naturaleza. Incluye hospedaje, actividades y relax para 4 personas.',
                includes: [
                    'Hospedaje 2 noches (HabitaciÃ³n Familiar)',
                    'Entrada al PailÃ³n del Diablo',
                    'Desayunos buffet incluidos',
                    'Tour en Chiva nocturna'
                ],
                itinerary: [
                    { time: 'DÃ­a 1', desc: 'Llegada y check-in. Visita a la Casa del Ãrbol.' },
                    { time: 'DÃ­a 2', desc: 'Ruta de las cascadas y tarde de piscina termal.' },
                    { time: 'DÃ­a 3', desc: 'Desayuno tÃ­pico y retorno.' }
                ],
                icon: 'users',
                color: 'blue'
            },
            {
                id: 'romantico',
                title: 'Plan RomÃ¡ntico: Cena y Centro HistÃ³rico',
                price: '$200',
                points: 250,
                tag: 'PAREJAS',
                img: 'https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?q=80&w=1000&auto=format&fit=crop', // Cocktail/Dinner
                description: 'Sorprende a tu pareja con una noche mÃ¡gica en el corazÃ³n de Quito colonial.',
                includes: [
                    'Noche en Hotel Boutique (Centro HistÃ³rico)',
                    'Cena romÃ¡ntica de 3 tiempos en azotea',
                    'DecoraciÃ³n especial en habitaciÃ³n',
                    'Botella de vino de bienvenida'
                ],
                itinerary: [
                    { time: '18:00', desc: 'Check-in y cÃ³ctel de bienvenida.' },
                    { time: '20:00', desc: 'Cena a la luz de las velas con vista al Panecillo.' },
                    { time: 'MaÃ±ana', desc: 'Desayuno en la cama.' }
                ],
                icon: 'heart',
                color: 'pink'
            },
            {
                id: 'cultural',
                title: 'Aventura Cultural: Leyendas de Quito',
                price: '$120',
                points: 180,
                tag: 'CULTURA',
                img: 'https://images.unsplash.com/photo-1568605114967-8130f3a36994?q=80&w=1000&auto=format&fit=crop', // Colonial House
                description: 'SumÃ©rgete en las historias secretas de la ciudad. Un recorrido guiado teatralizado.',
                includes: [
                    'Tour nocturno teatralizado "Leyendas de Quito"',
                    'Entrada a la Iglesia de la CompaÃ±Ã­a (CÃºpulas)',
                    'Canelazo quiteÃ±o tradicional',
                    'Transporte privado'
                ],
                itinerary: [
                    { time: '19:00', desc: 'Punto de encuentro en Plaza Grande.' },
                    { time: '20:30', desc: 'Visita exclusiva a catacumbas.' },
                    { time: '22:00', desc: 'DegustaciÃ³n de dulces tradicionales.' }
                ],
                icon: 'theater-masks',
                color: 'purple'
            }
        ];

        // --- RENDERIZADO ---
        const container = document.getElementById('planesContainer');

        PlanesData.forEach(plan => {
            const card = document.createElement('div');
            // Colores dinÃ¡micos
            const colorClass = plan.color === 'pink' ? 'text-pink-500 bg-pink-100' :
                plan.color === 'purple' ? 'text-purple-500 bg-purple-100' :
                    'text-blue-600 bg-blue-100';

            card.className = "bg-white p-5 rounded-3xl shadow-sm border border-gray-100 hover:shadow-md transition cursor-pointer";
            card.onclick = () => openPlanModal(plan); // Click en toda la tarjeta

            card.innerHTML = `
                <div class="flex gap-4 mb-4">
                    <div class="w-14 h-14 ${colorClass} rounded-2xl flex items-center justify-center text-2xl flex-shrink-0">
                        <i class="fas fa-${plan.icon}"></i>
                    </div>
                    <div>
                        <h2 class="font-bold text-lg text-gray-900 leading-tight">${plan.title}</h2>
                        <p class="text-gray-500 text-xs mt-1">${plan.tag}</p>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="font-bold text-gray-800 text-sm">ðŸ’µ ${plan.price}</span>
                            <span class="text-gray-300">â€¢</span>
                            <span class="bg-yellow-100 text-yellow-700 text-[10px] font-bold px-2 py-0.5 rounded-full">+${plan.points}pts</span>
                        </div>
                    </div>
                </div>
                <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 rounded-xl transition shadow-lg shadow-blue-200 active:scale-95 text-sm pointer-events-none">
                    Ver Detalles del Plan
                </button>
            `;
            container.appendChild(card);
        });

        // --- LÃ“GICA DEL MODAL ---
        const modal = document.getElementById('planModal');
        const modalContent = document.getElementById('planModalContent');
        let currentPlan = null;

        function openPlanModal(plan) {
            currentPlan = plan;

            // Llenar datos
            document.getElementById('modalHeroImg').src = plan.img;
            document.getElementById('modalTag').innerText = plan.tag;
            document.getElementById('modalTitle').innerText = plan.title;
            document.getElementById('modalPrice').innerText = plan.price;
            document.getElementById('modalPoints').innerText = `+${plan.points}pts`;
            document.getElementById('modalDesc').innerText = plan.description;

            // Llenar Includes
            const list = document.getElementById('modalIncludes');
            list.innerHTML = '';
            plan.includes.forEach(item => {
                const li = document.createElement('li');
                li.className = "flex items-start";
                li.innerHTML = `<i class="fas fa-check text-green-500 mt-1 mr-2 text-xs"></i> <span>${item}</span>`;
                list.appendChild(li);
            });

            // Llenar Itinerario
            const timeline = document.getElementById('modalItinerary');
            timeline.innerHTML = '';
            plan.itinerary.forEach(item => {
                const div = document.createElement('div');
                div.className = "relative";
                div.innerHTML = `
                    <div class="absolute -left-[25px] top-1 w-4 h-4 rounded-full bg-blue-200 border-2 border-white shadow-sm"></div>
                    <p class="text-xs font-bold text-gray-500 mb-1">${item.time}</p>
                    <p class="text-sm text-gray-800">${item.desc}</p>
                `;
                timeline.appendChild(div);
            });

            // Configurar botÃ³n
            const btn = document.getElementById('btnCompletar');
            btn.onclick = () => completarPlan(plan);

            // Mostrar
            modal.classList.remove('hidden');
            setTimeout(() => { modalContent.classList.remove('scale-95'); modalContent.classList.add('scale-100'); }, 10);
        }

        function closePlanModal() {
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        async function completarPlan(plan) {
            if (confirm(`Â¿Confirmas que has completado el "${plan.title}"?`)) {
                await Session.updatePoints(plan.points, 'Completar Plan: ' + plan.title);
                alert(`Â¡Felicidades! ðŸŽ‰\nHas ganado +${plan.points} puntos.`);
                closePlanModal();
                location.reload();
            }
        }

        // Puntos Nav Update
        document.addEventListener('DOMContentLoaded', () => {
            const u = Session.getUser();
            if (u && document.getElementById('puntos-nav')) {
                document.getElementById('puntos-nav').innerText = u.puntos || 0;
            }
        });

    </script>
</body>

</html>